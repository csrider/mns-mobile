var versionInfoForJavascriptFile_dialogs={version:"1.12",build:"2015.05.07"};function ClassMessageReplyDialog(instanceName){this.initialized=false;this.isVisible=false;this.yuiPanel;var _yuiPanel;var _log=function(logLevel,strMsg,doConsole){if((typeof window.FavScreen==="object")&&(typeof window.FavScreen.log==="function")){return window.FavScreen.log(logLevel,strMsg,doConsole);}else{if(logLevel=="log"){return console.log(strMsg);}else{if(logLevel=="info"){return console.info(strMsg);}else{if(logLevel=="warn"){return console.warn(strMsg);}else{if(logLevel=="error"){return console.error(strMsg);}else{return false;}}}}}};YUI().use("panel",function(Y){_yuiPanel=new Y.Panel({headerContent:null,bodyContent:null,footerContent:null,buttons:null,zIndex:999,width:"90%",centered:true,modal:true,visible:false,render:true});});_yuiPanel.after("init",function(e){this.get("boundingBox")._node.style.outline="none";this.get("contentBox")._node.className="MessageReplyDialog roundedcorners";FastClick.attach(document.getElementById("panelconfirmclosemsg"));});_yuiPanel.after("visibleChange",function(e){var node_modalMask=document.getElementsByClassName("yui3-widget-mask")[0];var headerwrapperHeight=document.getElementById("headerwrapper").offsetHeight;if(this.get("visible")){_log("log","ClassMessageReplyDialog: Now visible.",true);node_modalMask.style.display="block";node_modalMask.style.top=headerwrapperHeight+"px";}else{_log("log","ClassMessageReplyDialog: Now hidden.",true);node_modalMask.style.display="none";node_modalMask.style.top="0px";}});this.yuiPanel=_yuiPanel;var _hide=function(){_log("log","ClassMessageReplyDialog: Hide method invoked...",true);window.safeToHideModalMask=true;this.yuiPanel.hide();this.isVisible=false;};this.hide=_hide;var _show=function(o){_log("log","ClassMessageReplyDialog: Show method invoked...",true);window.safeToHideModalMask=false;var node_bodyContents=generateContentForShowing(o);this.yuiPanel.set("bodyContent",node_bodyContents);this.yuiPanel.show();this.isVisible=true;};this.show=_show;var generateContentForShowing=function(){var node_img_close=document.createElement("img");node_img_close.src=window.FAVS_ICON_CLOSE_X;var node_btn_close=document.createElement("button");node_btn_close.id="btnClose";node_btn_close.addEventListener("click",function(){window.FavScreen.MessageReplyDialog.hide();});node_btn_close.appendChild(node_img_close);var node_div_replyToMsg_msgWrapper=document.createElement("div");node_div_replyToMsg_msgWrapper.className="msgwrapper";node_div_replyToMsg_msgWrapper.innerHTML=window.FavScreen.objMsgData_replyTo.replyToMsgText.substr(0,30);var node_div_replyToMsg_textWrapper=document.createElement("div");node_div_replyToMsg_textWrapper.appendChild(node_div_replyToMsg_msgWrapper);var node_div_row1=document.createElement("div");node_div_row1.appendChild(node_btn_close);node_div_row1.appendChild(node_div_replyToMsg_textWrapper);var node_img_icon=document.createElement("img");node_img_icon.className="favIcon";var node_span_reply=document.createElement("span");if(typeof window.FavScreen.objMsgData_replyWith==="object"){if(typeof window.FavScreen.objMsgData_replyWith.replyWithFavIcon==="string"){node_img_icon.src=window.FavScreen.objMsgData_replyWith.replyWithFavIcon;}else{node_img_icon.src="";}node_span_reply.innerHTML=window.FavScreen.objMsgData_replyWith.replyWithFavName;}else{_log("error","ClassMessageReplyDialog: Missing global data object (window.FavScreen.objMsgData_replyWith) for reply-with message.",true);node_span_reply.innerHTML="<div>Error: Missing data for reply-with message.<div>";}var node_btn_reply=document.createElement("button");node_btn_reply.id="btnReply";node_btn_reply.className="bigiosstyle";node_btn_reply.type="button";node_btn_reply.addEventListener("click",function(){Spinner.show();setTimeout(function(){var response=window.sendReplyToMsg();if(response){_log("log","ClassMessageReplyDialog: Success reported in response from sendReplyToMsg().",true);Spinner.show();setTimeout(function(){window.refreshRecordset_inboxMsgs(CURRENT_USER_PIN,true,true);},1000);window.FavScreen.MessageReplyDialog.hide();window.FavScreen.set("attrInteractionMode",window.MODE_LAUNCHABLE);window.scrollTo_animated(document.body,FavScreen.get("attrPreviousScrollPositionPixelY"),150);window.ModalNotification_OK.showFor(2000);}else{_log("warn","ClassMessageReplyDialog: Failure reported in response from sendReplyToMsg().",true);}},200);});node_btn_reply.appendChild(node_img_icon);node_btn_reply.appendChild(node_span_reply);var node_div_row2=document.createElement("div");node_div_row2.style.clear="right";node_div_row2.appendChild(node_btn_reply);var node_ta_reply=document.createElement("textarea");node_ta_reply.placeholder="Your note";node_ta_reply.rows="8";node_ta_reply.name="yournote";node_ta_reply.maxLength="280";var node_div_row3=document.createElement("div");node_div_row3.appendChild(node_ta_reply);var node_div_main=document.createElement("div");node_div_main.appendChild(node_div_row1);node_div_main.appendChild(node_div_row2);node_div_main.appendChild(node_div_row3);return node_div_main;};this.initialized=true;}function assembleDataObjectForFavRecno(favRecno){var ret={};try{ret.favRecno=favRecno;ret.favName=rsRec_getFavName(FavScreen.rsOrig,favRecno);ret.favIcon=rsRec_getFavIcon(FavScreen.rsOrig,favRecno);ret.favIconSrc=FAVS_ICON_PATH+"/"+rsRec_getFavIcon(FavScreen.rsOrig,favRecno);if(ret.favName.length==0){ret.favName=rsRec_getMsgTemplateName(FavScreen.rsOrig,favRecno);}}catch(err){_log("error","assembleDataObjectForFavRecno(): Some problem getting data from recordset ("+err+"), returning incomplete data-object.",true);}this.objMsgData=ret;return ret;}function ClassPromptConfirmSend(instanceName){this.initialized=false;this.favRecno=undefined;this.objMsgData=undefined;this.yuiPanel;var yuiPanel;var handle_setTimeout=undefined;var _log=function(logLevel,strMsg,doConsole){if((typeof window.FavScreen==="object")&&(typeof window.FavScreen.log==="function")){return window.FavScreen.log(logLevel,strMsg,doConsole);}else{if(logLevel=="log"){return console.log(strMsg);}else{if(logLevel=="info"){return console.info(strMsg);}else{if(logLevel=="warn"){return console.warn(strMsg);}else{if(logLevel=="error"){return console.error(strMsg);}else{return false;}}}}}};var generateContentForShowing=function(objMsgData){var node_img_close=document.createElement("img");node_img_close.src=window.FAVS_ICON_CLOSE_X;var node_btn_close=document.createElement("button");node_btn_close.id="btnClose";node_btn_close.addEventListener("click",function(){window.ConfirmLaunch.hide();});node_btn_close.appendChild(node_img_close);var node_div_headerWrapper=document.createElement("div");node_div_headerWrapper.className="panelheaderwrapper";if(FavScreen.get("attrInteractionMode")==MODE_REPLYING){node_div_headerWrapper.innerHTML="Respond";}else{node_div_headerWrapper.innerHTML="Send";}var node_div_row1=document.createElement("div");node_div_row1.appendChild(node_btn_close);node_div_row1.appendChild(node_div_headerWrapper);var node_img_icon=document.createElement("img");node_img_icon.className="favIcon";node_img_icon.src=objMsgData.favIconSrc;var node_span_msgTitle=document.createElement("span");node_span_msgTitle.innerHTML=objMsgData.favName;var node_btn_msg=document.createElement("button");node_btn_msg.id="btnMsg";node_btn_msg.className="bigiosstyle";node_btn_msg.type="button";node_btn_msg.addEventListener("click",function(){launchFavorite(objMsgData.favRecno,true);window.ConfirmLaunch.hide();});node_btn_msg.appendChild(node_img_icon);node_btn_msg.appendChild(node_span_msgTitle);var node_div_row2=document.createElement("div");node_div_row2.style.clear="right";node_div_row2.appendChild(node_btn_msg);var node_div_main=document.createElement("div");node_div_main.appendChild(node_div_row1);node_div_main.appendChild(node_div_row2);return node_div_main;};YUI().use("panel",function(Y){_yuiPanel=new Y.Panel({id:"panelconfirmsend",headerContent:null,bodyContent:null,footerContent:null,buttons:null,zIndex:999,width:"90%",centered:true,modal:true,visible:false,render:true});_yuiPanel.after("init",function(e){this.get("boundingBox")._node.style.outline="none";FastClick.attach(document.getElementById("panelconfirmsend"));});var node_modalMask=document.getElementsByClassName("yui3-widget-mask")[0];var headerwrapperHeight=document.getElementById("headerwrapper").offsetHeight;if(!(headerwrapperHeight>0)){headerwrapperHeight=60;}_yuiPanel.after("visibleChange",function(e){if(this.get("visible")){node_modalMask.style.display="block";node_modalMask.style.top=headerwrapperHeight+"px";}else{node_modalMask.style.display="none";node_modalMask.style.top="0px";}});});this.yuiPanel=_yuiPanel;this.show=function(favRecno){if(typeof handle_setTimeout!=="undefined"){clearTimeout(handle_setTimeout);}if(typeof favRecno==="undefined"){console.log(instanceName+".show method invoked without favRecno provided. Aborting");return false;}else{console.log(instanceName+".show method invoked with favRecno="+favRecno+".");this.favRecno=favRecno;var o=assembleDataObjectForFavRecno(favRecno);var node_bodyContents=generateContentForShowing(o);this.yuiPanel.set("bodyContent",node_bodyContents);if(FavScreen.get("attrInteractionMode")==MODE_REPLYING){this.yuiPanel.get("contentBox")._node.className="MessageConfirmDialog confirmrespond roundedcorners";}else{this.yuiPanel.get("contentBox")._node.className="MessageConfirmDialog confirmsend roundedcorners";}return this.yuiPanel.show();}};this.hide=function(intDelayMs){console.log(instanceName+".hide method invoked.");if(typeof handle_setTimeout!=="undefined"){clearTimeout(handle_setTimeout);}this.favRecno=undefined;if(typeof intDelayMs==="undefined"||isNaN(intDelayMs)){this.yuiPanel.hide();}else{if(parseInt(intDelayMs,10)>50){handle_setTimeout=setTimeout(function(){this.yuiPanel.hide();},parseInt(intDelayMs,10));}else{this.yuiPanel.hide();}}};this.isVisible=function(){if(this.yuiPanel.get("visible")){return true;}else{return false;}};this.showFor=function(favRecno,intTimeoutMs){if(typeof favRecno==="undefined"){console.log(instanceName+".showFor method invoked without favRecno provided. Aborting");return false;}else{console.log(instanceName+".showFor method invoked. Showing it for "+intTimeoutMs+" milliseconds.");if(typeof handle_setTimeout!=="undefined"){clearTimeout(handle_setTimeout);}this.favRecno=favRecno;var yp;if(typeof intTimeoutMs==="number"){yp=this.show(favRecno);handle_setTimeout=setTimeout(function(){window.ConfirmLaunch.yuiPanel.hide();},parseInt(intTimeoutMs,10));}}return yp;};this.initialized=true;}function ClassPromptConfirmCloseMsg(instanceName){this.initialized=false;this.clickTargetId=undefined;this.favRecno=undefined;this.objMsgData=undefined;this.yuiPanel;var yuiPanel;var handle_setTimeout=undefined;var _log=function(logLevel,strMsg,doConsole){if((typeof window.FavScreen==="object")&&(typeof window.FavScreen.log==="function")){return window.FavScreen.log(logLevel,strMsg,doConsole);}else{if(logLevel=="log"){return console.log(strMsg);}else{if(logLevel=="info"){return console.info(strMsg);}else{if(logLevel=="warn"){return console.warn(strMsg);}else{if(logLevel=="error"){return console.error(strMsg);}else{return false;}}}}}};var generateContentForShowing=function(objMsgData){var node_img_close=document.createElement("img");node_img_close.src=window.FAVS_ICON_CLOSE_X;var node_btn_close=document.createElement("button");node_btn_close.id="btnClose";node_btn_close.addEventListener("click",function(){window.ConfirmCloseMsg.hide();});node_btn_close.appendChild(node_img_close);var node_div_headerWrapper=document.createElement("div");node_div_headerWrapper.className="panelheaderwrapper";node_div_headerWrapper.innerHTML="Close";var node_div_row1=document.createElement("div");node_div_row1.appendChild(node_btn_close);node_div_row1.appendChild(node_div_headerWrapper);if(objMsgData.isInboxMsg){var node_div_iconwrapper=document.createElement("div");node_div_iconwrapper.className="iconwrapper";if(objMsgData.node_li_messagecell.getElementsByClassName("iconwrapper")[0].childNodes[0].getAttribute("src").length<1){var node_span_bullet=document.createElement("span");node_span_bullet.innerHTML="&#x25cf;";node_span_bullet.className="bigblackbullet";node_div_iconwrapper.appendChild(node_span_bullet);}else{var node_img_icon=document.createElement("img");node_img_icon.className="favIcon";node_img_icon.src=objMsgData.node_li_messagecell.getElementsByClassName("iconwrapper")[0].childNodes[0].getAttribute("src");node_img_icon.align="left";node_div_iconwrapper.appendChild(node_img_icon);}var node_span_msgTitle=document.createElement("span");node_span_msgTitle.appendChild(objMsgData.node_li_messagecell.getElementsByClassName("msgwrapper")[0]);var node_btn_msg=document.createElement("button");node_btn_msg.id="btnMsg";node_btn_msg.type="button";node_btn_msg.className=objMsgData.node_li_messagecell.className+" bigiosstyle";node_btn_msg.addEventListener("click",function(){closeMessage(window.ConfirmCloseMsg.clickTargetId,true);window.ConfirmCloseMsg.hide();});node_btn_msg.appendChild(node_img_icon);node_btn_msg.appendChild(node_span_msgTitle);var node_div_row2=document.createElement("div");node_div_row2.style.clear="right";node_div_row2.appendChild(node_btn_msg);}else{var node_img_icon=document.createElement("img");node_img_icon.className="favIcon";node_img_icon.src=objMsgData.favIconSrc;var node_span_msgTitle=document.createElement("span");node_span_msgTitle.innerHTML=objMsgData.favName;var node_img_toggleicon=document.createElement("img");node_img_toggleicon.src=FAVS_ICON_TOGGLE_CLOSE;node_img_toggleicon.style.cssFloat="right";var node_btn_msg=document.createElement("button");node_btn_msg.id="btnMsg";node_btn_msg.className="bigiosstyle";node_btn_msg.type="button";node_btn_msg.addEventListener("click",function(){closeMessage(window.ConfirmCloseMsg.clickTargetId,true);window.ConfirmCloseMsg.hide();});node_btn_msg.appendChild(node_img_toggleicon);node_btn_msg.appendChild(node_img_icon);node_btn_msg.appendChild(node_span_msgTitle);var node_div_row2=document.createElement("div");node_div_row2.style.clear="right";node_div_row2.appendChild(node_btn_msg);}var node_div_main=document.createElement("div");node_div_main.appendChild(node_div_row1);node_div_main.appendChild(node_div_row2);return node_div_main;};YUI().use("panel",function(Y){_yuiPanel=new Y.Panel({id:"panelconfirmclosemsg",headerContent:null,bodyContent:null,footerContent:null,buttons:null,zIndex:999,width:"90%",centered:true,modal:true,visible:false,render:true});_yuiPanel.after("init",function(e){this.get("boundingBox")._node.style.outline="none";this.get("contentBox")._node.className="MessageConfirmDialog confirmclosemsg roundedcorners";FastClick.attach(document.getElementById("panelconfirmclosemsg"));});var node_modalMask=document.getElementsByClassName("yui3-widget-mask")[0];var headerwrapperHeight=document.getElementById("headerwrapper").offsetHeight;if(!(headerwrapperHeight>0)){headerwrapperHeight=60;}_yuiPanel.after("visibleChange",function(e){if(this.get("visible")){node_modalMask.style.display="block";node_modalMask.style.top=headerwrapperHeight+"px";}else{node_modalMask.style.display="none";node_modalMask.style.top="0px";}});});this.yuiPanel=_yuiPanel;this.show=function(clickTargetId){if(typeof handle_setTimeout!=="undefined"){clearTimeout(handle_setTimeout);}if(typeof clickTargetId==="undefined"){console.log(instanceName+".show method invoked without clickTargetId provided. Aborting");return false;}else{console.log(instanceName+".show method invoked with clickTargetId="+clickTargetId+".");this.clickTargetId=clickTargetId;if(isNaN(clickTargetId)){this.favRecno=clickTargetId.toString().split("_")[1];}else{this.favRecno=clickTargetId;}var o;if(document.getElementById(clickTargetId).className.indexOf("inboxmsg")>-1){o={isInboxMsg:true,node_li_messagecell:document.getElementById(clickTargetId).cloneNode(true)};}else{o=assembleDataObjectForFavRecno(this.favRecno);}var node_bodyContents=generateContentForShowing(o);this.yuiPanel.set("bodyContent",node_bodyContents);return this.yuiPanel.show();}};this.hide=function(intDelayMs){console.log(instanceName+".hide method invoked.");if(typeof handle_setTimeout!=="undefined"){clearTimeout(handle_setTimeout);}this.clickTargetId=undefined;if(typeof intDelayMs==="undefined"||isNaN(intDelayMs)){this.yuiPanel.hide();}else{if(parseInt(intDelayMs,10)>50){handle_setTimeout=setTimeout(function(){this.yuiPanel.hide();},parseInt(intDelayMs,10));}else{this.yuiPanel.hide();}}};this.isVisible=function(){if(this.yuiPanel.get("visible")){return true;}else{return false;}};this.showFor=function(clickTargetId,intTimeoutMs){if(typeof clickTargetId==="undefined"){console.log(instanceName+".showFor method invoked without clickTargetId provided. Aborting");return false;}else{console.log(instanceName+".showFor method invoked. Showing it for "+intTimeoutMs+" milliseconds.");if(typeof handle_setTimeout!=="undefined"){clearTimeout(handle_setTimeout);}this.clickTargetId=clickTargetId;var yp;if(typeof intTimeoutMs==="number"){yp=this.show(clickTargetId);handle_setTimeout=setTimeout(function(){window.ConfirmCloseMsg.yuiPanel.hide();},parseInt(intTimeoutMs,10));}}return yp;};this.initialized=true;}function ClassPanelSubsectionEdit(cfg){this.str_version="1.3";this.str_build="2015.05.07";this.bool_isConstructorLoaded=false;if(typeof FavScreen!=="object"){return console.error("ClassPanelSubsectionEdit: Instantiation requires a valid ClassFavScreen instance to exist in the global scope as 'FavScreen'. Aborting.");}if(typeof colorShade!=="function"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires dynamics:colorShade() to exist in the global scope. Aborting.",true);}if(typeof updateCharCountDisplay!=="function"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires updateCharCountDisplay() to exist in the global scope. Aborting.",true);}if(typeof YUI!=="function"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires YUI to exist in the global scope, as 'YUI'. Aborting.",true);}if(typeof FastClick!=="function"){FavScreen.log("info","ClassPanelSubsectionEdit: FastClick not found at instantiation-time (it might exist later?). It is not required, but recommended. Continuing...",true);}if(typeof ModalNotification_Saved!=="object"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires a ClassModalNotification instance to exist in the global scope as 'ModalNotification_Saved'. Aborting.",true);}if(typeof ModalNotification_OK!=="object"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires a ClassModalNotification instance to exist in the global scope as 'ModalNotification_OK'. Aborting.",true);}if(typeof ModalNotification_GeneralError!=="object"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires a ClassModalNotification instance to exist in the global scope as 'ModalNotification_GeneralError'. Aborting.",true);}if(typeof cfg!=="object"){return FavScreen.log("error","ClassPanelSubsectionEdit: Instantiation requires a configuration object to be provided. Aborting",true);}if(typeof cfg.str_panelDomID!=="string"){return FavScreen.log("error","ClassPanelSubsectionEdit: Invalid configuration object provided (required members missing or invalid). Aborting.",true);}if(typeof cfg.str_panelDomClassName!=="string"){cfg.str_panelDomClassName=String();}if(typeof cfg.str_panelTitleText!=="string"){cfg.str_panelTitleText=String();}if(typeof cfg.objFxn_refreshHandler!=="function"){FavScreen.log("info","ClassPanelSubsectionEdit: No specific refresh-handler provided. Any refresh operation will fall-back to the global refreshRecordset routine.",true);cfg.objFxn_refreshHandler=function(){window.refreshRecordset(CURRENT_USER_PIN,true,false,false);};}var cfg_defaults={str_panelDomClassName:"",str_panelTitleText:"Edit Header"};if(cfg.str_panelDomClassName.length===0){cfg.str_panelDomClassName=cfg_defaults.str_panelDomClassName;}if(cfg.str_panelTitleText.length===0){cfg.str_panelTitleText=cfg_defaults.str_panelTitleText;}function generatePanelHeading(){var ret=null;var cfg_div_id="";var cfg_div_classname="";FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": generatePanelHeading(): Starting...",true);try{var oNode_div=document.createElement("div");oNode_div.setAttribute("id",cfg_div_id);oNode_div.setAttribute("class",cfg_div_classname);var oNode_text_button_addNewAbove=document.createTextNode("Add a New Header");var oNode_button_addNewAbove=document.createElement("button");oNode_button_addNewAbove.setAttribute("id","btn-addnewheaderabove");oNode_button_addNewAbove.setAttribute("class","yui3-button");oNode_button_addNewAbove.appendChild(oNode_text_button_addNewAbove);oNode_button_addNewAbove.addEventListener("click",function(e){e.preventDefault();handleAddNewHeaderButtonClick(e);});var oNode_text_titleText=document.createTextNode(cfg.str_panelTitleText);var oNode_span_titleText=document.createElement("span");oNode_span_titleText.appendChild(oNode_text_titleText);var oNode_div_clearfloats=document.createElement("div");oNode_div_clearfloats.setAttribute("class","clearfloats");oNode_div.appendChild(oNode_button_addNewAbove);oNode_div.appendChild(oNode_span_titleText);oNode_div.appendChild(oNode_div_clearfloats);FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": generatePanelHeading(): Completed. Returning DIV node.",true);return oNode_div;}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": generatePanelHeading(): Caught error ("+err.message+").",true);return ret;}}function generateColorTiles(){var ret=null;var arrColors=["#F7977A","#FDC68A","#FFF79A","#C4DF9B","#7BCDC8","#F6989D","#F49AC2","#A187BE","#7EA7D8","#6ECFF6"];var cfg_paletteAdjustment=0.6;var cfg_numberOfTilesPerRowDesired=5;var oNode_span_wrapper=document.createElement("span");var oNode_div_row=document.createElement("div");var oNode_span_colorTile_template=document.createElement("span");oNode_span_colorTile_template.setAttribute("class","colortile");var oNode_span_colorTile_toAdd;var handleColorSelection=function(e){handleColorDynamics(e);};var j=0;for(var i=0;i<arrColors.length;i++){oNode_span_colorTile_toAdd=oNode_span_colorTile_template.cloneNode();oNode_span_colorTile_toAdd.style.backgroundColor=colorShade_brightness(arrColors[i],cfg_paletteAdjustment);oNode_span_colorTile_toAdd.addEventListener("click",function(e){handleColorDynamics(e);});oNode_div_row.appendChild(oNode_span_colorTile_toAdd);j++;if(j===cfg_numberOfTilesPerRowDesired||j===arrColors.length){oNode_span_wrapper.appendChild(oNode_div_row);oNode_div_row=document.createElement("div");}}ret=oNode_span_wrapper;return ret;}function generatePanelBody(objMsgData){var ret=null;var cfg_div_id="";var cfg_div_classname="";FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": generatePanelBody(): Starting...",true);try{objMsgData=objMsgData||{};cfg.obj_recordData=objMsgData;var shouldIgnoreChangeInIP=String(window.determineShouldIgnoreChangeInIP());var currentUserPin=String(window.CURRENT_USER_PIN);var record_favRecno=objMsgData.recno_fav||"0";var record_label1=objMsgData.label1||"";var record_position=String(window.rsRec_getFavPosition(FavScreen.rsOrig,record_favRecno));var record_baseColor=objMsgData.color||objConfig_MajorSection_personalLibs.str_baseColor;var oNode_div=document.createElement("div");oNode_div.setAttribute("id",cfg_div_id);oNode_div.setAttribute("class",cfg_div_classname);var oNode_form=document.createElement("form");oNode_form.setAttribute("id","form_editHeader");var oNode_fld_smcgiCommand=document.createElement("input");oNode_fld_smcgiCommand.setAttribute("type","hidden");oNode_fld_smcgiCommand.setAttribute("id","fld_smcgi_command");oNode_fld_smcgiCommand.setAttribute("name","updateFavRecord");oNode_fld_smcgiCommand.setAttribute("value","true");var oNode_fld_smcgiAuthentication=document.createElement("input");oNode_fld_smcgiAuthentication.setAttribute("type","hidden");oNode_fld_smcgiAuthentication.setAttribute("name",window.CGI_IDENT_FIELD);oNode_fld_smcgiAuthentication.setAttribute("value",window.CURRENT_USER_PIN_ENCODED);var oNode_fld_smcgiDisableCheckIP=document.createElement("input");oNode_fld_smcgiDisableCheckIP.setAttribute("type","hidden");oNode_fld_smcgiDisableCheckIP.setAttribute("name","disableCheckForIP_favorites");oNode_fld_smcgiDisableCheckIP.setAttribute("value",shouldIgnoreChangeInIP);var oNode_fld_userPin=document.createElement("input");oNode_fld_userPin.setAttribute("type","hidden");oNode_fld_userPin.setAttribute("name","userPin");oNode_fld_userPin.setAttribute("value",currentUserPin);var oNode_fld_favRecno=document.createElement("input");oNode_fld_favRecno.setAttribute("type","hidden");oNode_fld_favRecno.setAttribute("name","recno_fav");oNode_fld_favRecno.setAttribute("value",record_favRecno);var oNode_fld_favPosition=document.createElement("input");oNode_fld_favPosition.setAttribute("type","hidden");oNode_fld_favPosition.setAttribute("id","fld_position");oNode_fld_favPosition.setAttribute("name","position");oNode_fld_favPosition.setAttribute("value",record_position);var oNode_fld_colorHexString=document.createElement("input");oNode_fld_colorHexString.setAttribute("type","hidden");oNode_fld_colorHexString.setAttribute("id","fld_color_hex");oNode_fld_colorHexString.setAttribute("name","color_hex");oNode_fld_colorHexString.setAttribute("value",record_baseColor);oNode_form.appendChild(oNode_fld_smcgiCommand);oNode_form.appendChild(oNode_fld_smcgiAuthentication);oNode_form.appendChild(oNode_fld_smcgiDisableCheckIP);oNode_form.appendChild(oNode_fld_userPin);oNode_form.appendChild(oNode_fld_favRecno);oNode_form.appendChild(oNode_fld_favPosition);oNode_form.appendChild(oNode_fld_colorHexString);var oNode_fld_headerName=document.createElement("input");oNode_fld_headerName.setAttribute("type","text");oNode_fld_headerName.setAttribute("id","label1");oNode_fld_headerName.setAttribute("name","label1");oNode_fld_headerName.setAttribute("value",record_label1);oNode_fld_headerName.setAttribute("maxLength",window.FAVS_FAVNAME_MAXLENGTH);var oNode_div_colorTiles=document.createElement("div");oNode_div_colorTiles.setAttribute("class","colortilecontainer");oNode_div_colorTiles.appendChild(generateColorTiles());var oNode_div_previewSubheader=document.createElement("div");oNode_div_previewSubheader.setAttribute("id","subsection-preview-subheader");oNode_div_previewSubheader.setAttribute("class","roundedtopcorners8");oNode_div_previewSubheader.style.backgroundColor=colorShade(oNode_fld_colorHexString.getAttribute("value"),-0.1);oNode_div_previewSubheader.appendChild(oNode_fld_headerName);var oNode_div_previewSubsection=document.createElement("div");oNode_div_previewSubsection.setAttribute("id","subsection-preview-subsection");oNode_div_previewSubsection.style.backgroundColor=oNode_fld_colorHexString.getAttribute("value");var oNode_div_preview=document.createElement("div");oNode_div_preview.setAttribute("id","subsection-preview");oNode_div_preview.appendChild(oNode_div_previewSubheader);oNode_div_preview.appendChild(oNode_div_previewSubsection);oNode_form.appendChild(oNode_div_preview);oNode_form.appendChild(oNode_div_colorTiles);oNode_div.appendChild(oNode_form);FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": generatePanelBody(): Completed. Returning DIV node.",true);return oNode_div;}catch(err){FavScreen.log("warn","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": generatePanelBody(): Caught error ("+err.message+"). This should be expected on first load where there is no record context.",true);return ret;}}function updateCharCounter(objNode_charCounterToUpdate,intCurrentChars,intMaxChars){try{objNode_charCounterToUpdate.innerHTML="("+intCurrentChars+"/"+intMaxChars+")";if(intCurrentChars>=intMaxChars){if(typeof objNode_charCounterToUpdate.classList==="object"){objNode_charCounterToUpdate.classList.add("warn");}else{FavScreen.log("warn","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updateCharCounter(): Client does not support classList, unable to add 'warn' class.",true);}if(intCurrentChars>intMaxChars){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updateCharCounter(): User attempting to enter more characters than allowed, returning false.",true);return false;}}else{if(typeof objNode_charCounterToUpdate.classList==="object"){objNode_charCounterToUpdate.classList.remove("warn");}else{FavScreen.log("warn","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updateCharCounter(): Client does not support classList, unable to remove 'warn' class.",true);}}}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updateCharCounter(): Caught error ("+err.message+").",true);}}function updatePreviewText(updatedText){try{var objNode_previewSubheader=document.getElementById("subsection-preview-subheader");objNode_previewSubheader.innerHTML=updatedText;}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updatePreviewText(): Caught error ("+err.message+").",true);}}function updatePreviewColor(updatedColor){try{var objNode_preview_subheader=document.getElementById("subsection-preview-subheader");var objNode_preview_subsection=document.getElementById("subsection-preview-subsection");objNode_preview_subheader.style.backgroundColor=colorShade(updatedColor,-0.1);objNode_preview_subsection.style.backgroundColor=updatedColor;}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updatePreviewColor(): Caught error ("+err.message+").",true);}}function handleFieldDynamics(evt){updateCharCounter(document.getElementById("charcountdisplay-subsectionedit-label1"),evt.currentTarget.value.length,window.FAVS_FAVNAME_MAXLENGTH);updatePreviewText(evt.currentTarget.value);}function handleColorDynamics(evt){function rgb2hex(rgb){rgb=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function hex(x){return("0"+parseInt(x).toString(16)).slice(-2);}return"#"+hex(rgb[1])+hex(rgb[2])+hex(rgb[3]);}var rawColorAsRGB=evt.currentTarget.style.backgroundColor;var colorAsHex=rgb2hex(rawColorAsRGB);updatePreviewColor(colorAsHex);document.getElementById("fld_color_hex").value=colorAsHex;}function handleAddNewHeaderButtonClick(evt){var cfg_li_classname="subsectionheader sublistheader roundedtopcorners8";FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Starting...",true);try{var objRecordData=cfg.obj_recordData;var oNodeRef_li_subheaderEditing=document.getElementById(objRecordData.recno_fav);var oNodeRef_li_subheaderEditing_parent=oNodeRef_li_subheaderEditing.parentNode;var str_contextualListID=oNodeRef_li_subheaderEditing_parent.getAttribute("id");var oNode_text_sectionTitleText=document.createTextNode(window.FAVS_SECTION_TITLE_PERSONAL_LIB_DEFAULT_BLANKNEW);var oNode_span_sectionTitleText=document.createElement("span");oNode_span_sectionTitleText.appendChild(oNode_text_sectionTitleText);var oNode_li=document.createElement("li");oNode_li.setAttribute("class",cfg_li_classname);oNode_li.appendChild(oNode_span_sectionTitleText);FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Inserting a new subheader-LI into the DOM, before the current LI...",true);oNodeRef_li_subheaderEditing_parent.insertBefore(oNode_li,oNodeRef_li_subheaderEditing);if(str_contextualListID==objConfig_MajorSection_personalLibs.str_sectionDomID){FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Requesting updated recordset from the personal-libs major section...",true);window.FavScreen.rsEdited=MajorSection_personalLibs.exportListAsYuiRecordset();oNodeRef_li_subheaderEditing_parent.insertBefore(MajorSection_personalLibs.generateListItem_noMessagesCell(),oNodeRef_li_subheaderEditing);}else{if(str_contextualListID==objConfig_MajorSection_critical.str_sectionDomID){FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Requesting updated recordset from the critical major section...",true);window.FavScreen.rsEdited=MajorSection_critical.exportListAsYuiRecordset();}else{FavScreen.log("warn","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Major section does not support saving new subheaders.",true);return false;}}FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Saving updated list items...",true);window.saveSortedFavRecnosToSMCGI(window.FavScreen.rsEdited);cfg.obj_panel.hide();}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": handleAddNewHeaderButtonClick(): Caught error ("+err.message+").",true);}}this.bool_isInstanceInitialized=false;this.bool_isVisible=false;this.cfg=cfg;this.initialize=function(){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): Starting...",true);if(this.bool_isConstructorLoaded){var myYUI;FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): Instantiating YUI Panel & IO...",true);YUI().use("panel","recordset","io","io-base","io-form",function(Y){var objResponse;var handleStart=function(ioId,o){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-IO: Starting.",true);};var handleSuccess=function(ioId,o){var rt=o.responseText;FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-IO: Success. Analyzing server-response...",true);};var handleFailure=function(ioId,o){var rt=o.responseText;FavScreen.log("warn","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-IO: Failure.",true);FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-IO: Response-text = '"+rt+"'.",true);};var obj_cfg_yuiIO={on:{start:handleStart,success:handleSuccess,failure:handleFailure},method:"POST",form:{id:"form_editHeader"},headers:{"Content-Type":"application/x-www-form-urlencoded"},sync:true,timeout:10000};FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-IO: Configured timeout will be "+obj_cfg_yuiIO.timeout+"ms.",true);var objPanel=new Y.Panel({id:cfg.str_panelDomID,width:"90%",maxWidth:"90%",zIndex:5,centered:true,modal:true,visible:false,render:true,buttons:[{value:"Delete",section:Y.WidgetStdMod.FOOTER,classNames:"btndelete",action:function(e){e.preventDefault();FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: User clicked 'Delete' button.",true);document.getElementById("fld_position").value=FAVS_DELETED_FLAG+FAVS_POSITION_DELINEATE_TYPE+"00000"+FAVS_POSITION_DELINEATE_COORD+"00000"+FAVS_POSITION_DELINEATE_COORD+"00000";objResponse=Y.io(window.CGI_SERVER,obj_cfg_yuiIO);if(objResponse.responseText==="true"){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Delete succeeded, hiding panel...",true);window.ModalNotification_OK.showFor(1500);this.hide();setTimeout(function(){cfg.objFxn_refreshHandler();},1000);}else{FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Delete failed, user can try again.",true);window.ModalNotification_GeneralError.showFor(2000);}}},{value:"Save",section:Y.WidgetStdMod.FOOTER,classNames:"btnsave",action:function(e){e.preventDefault();FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: User clicked 'Save' button.",true);objResponse=Y.io(window.CGI_SERVER,obj_cfg_yuiIO);if(objResponse.responseText==="true"){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Save succeeded, hiding panel...",true);window.ModalNotification_Saved.showFor(1500);this.hide();setTimeout(function(){cfg.objFxn_refreshHandler();},1000);}else{FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Save failed, user can try again.",true);window.ModalNotification_GeneralError.showFor(2000);}}},{value:"Cancel",section:Y.WidgetStdMod.FOOTER,classNames:"btncancel",action:function(e){e.preventDefault();FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: User clicked 'Cancel' button, hiding panel.",true);this.hide();}}]});objPanel.after("visibleChange",function(e){FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Visibility changed from "+e.prevVal+" to "+e.newVal+".",true);});objPanel.after("init",function(e){try{FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Generating and setting panel heading & body content...",true);this.set("headerContent",generatePanelHeading());this.set("bodyContent",generatePanelBody());FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Attaching FastClick...",true);FastClick.attach(cfg.str_panelDomID);}catch(err){FavScreen.log("info","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: FastClick not attached ("+err.message+").",true);}FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI-Panel: Now initialized and rendered.",true);});cfg.obj_panel=objPanel;FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): YUI initializations complete. Panel is now ready for action!",true);});this.bool_isInstanceInitialized=true;FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): Almost done... Panel will be ready for action, momentarily (after YUI initializations complete). Now setting bool_isInstanceInitialized and returning "+this.bool_isInstanceInitialized+".",true);return this.bool_isInstanceInitialized;}else{return FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": initialize(): Class prototype not yet loaded (bool_isLoaded = "+this.bool_isLoaded+").",true);}};this.updatePanelWithNewSubsectionData=function(objMsgData){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updatePanelWithNewSubsectionData(): Starting...",true);var ret=false;try{cfg.obj_panel.set("bodyContent",generatePanelBody(objMsgData));cfg.obj_recordData=objMsgData;}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": updatePanelWithNewSubsectionData(): Caught error ("+err.message+"). Returning "+ret+".",true);}return ret;};this.show=function(){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": show(): Starting...",true);var ret=false;try{this.cfg.obj_panel.show();ret=Boolean(this.cfg.obj_panel.get("visible"));FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": show(): Completed. Setting bool_isVisible and returning "+ret+".",true);}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": show(): Caught error ("+err.message+"). Returning "+ret+".",true);}return ret;};this.hide=function(){FavScreen.log("verbose","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": hide(): Starting...",true);var ret=false;try{this.cfg.obj_panel.hide();ret=Boolean(this.cfg.obj_panel.get("visible"));FavScreen.log("log","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": hide(): Completed. Setting bool_isVisible and returning "+ret+".",true);}catch(err){FavScreen.log("error","ClassPanelSubsectionEdit #"+cfg.str_panelDomID+": hide(): Caught error ("+err.message+"). Returning "+ret+".",true);}return ret;};this.bool_isConstructorLoaded=true;}