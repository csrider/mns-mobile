var versionInfoForJavascriptFile_favscreen={version:"1.10",build:"2015.05.15"};function ClassMajorSection(cfg){this.version="3.1";this.build="2015.05.15";this.bool_isConstructorLoaded=false;if(typeof window.FavScreen!=="object"){return console.error("ClassMajorSection: Instantiation requires a valid ClassFavScreen instance to exist in the global scope, as FavScreen. Aborting.");}if((typeof FAVS_ICON_REFRESH!=="string"||FAVS_ICON_REFRESH.length<5)||(typeof EXPANDED_STATE!=="string"||EXPANDED_STATE.length===0)||(typeof COLLAPSED_STATE!=="string"||COLLAPSED_STATE.length===0)){return FavScreen.log("error","ClassMajorSection: Instantiation requires certain valid variables/constants to exist in the global scope. Aborting.",true);}if(typeof window.versionInfoForJavascriptFile_dynamics!=="object"){return FavScreen.log("error","ClassMajorSection: Instantiation requires a valid 'dynamics' JavaScript framework to exist in the global scope. Aborting.",true);}if(typeof window.versionInfoForJavascriptFile_secur!=="object"){return FavScreen.log("error","ClassMajorSection: Instantiation requires a valid 'secur' JavaScript framework to exist in the global scope. Aborting.",false);}else{if(typeof window.vig_crypt!=="function"){return FavScreen.log("error","ClassMajorSection: Instantiation requires a valid 'vig_crypt' function to exist in the global scope. Aborting.",false);}}if(typeof cfg!=="object"){return FavScreen.log("error","ClassMajorSection: Instantiation requires a valid configuration object to be provided. Aborting",true);}if(typeof cfg.str_containerNodeID!=="string"||typeof cfg.str_sectionDomID!=="string"){return FavScreen.log("error","ClassMajorSection: Invalid configuration object provided (required members missing or invalid). Aborting.",true);}if(typeof cfg.str_sectionDomClassName!=="string"){cfg.str_sectionDomClassName=String();}if(typeof cfg.str_sectionTitleText!=="string"){cfg.str_sectionTitleText=String();}if(typeof cfg.bool_enableRefreshIcon!=="boolean"){cfg.bool_enableRefreshIcon=Boolean(true);}if(typeof cfg.objFxn_refreshHandler!=="function"){cfg.objFxn_refreshHandler=function(){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": cfg.objFxn_refreshHandler not specified.",true);};}if(typeof cfg.bool_enableExpandCollapseIcon!=="boolean"){cfg.bool_enableExpandCollapseIcon=Boolean(true);}if(typeof cfg.str_initialExpandCollapse!=="string"){cfg.str_initialExpandCollapse=String();}if(typeof cfg.str_baseColor!=="string"){cfg.str_baseColor=String();}if(typeof cfg.objArr_messageData!=="object"&&typeof cfg.objYuiRS_messageData!=="object"){cfg.objArr_messageData=[];}if(typeof cfg.objRef_subheaderEditPanelInstance!=="object"){FavScreen.log("info","ClassMajorSection: No subheader edit panel instance provided. Won't be able to edit any potential subheaders.",true);cfg.objRef_subheaderEditPanelInstance={};}var cfg_defaults={str_sectionDomClassName:"",str_baseColor:"#CCCCCC",bool_enableRefreshIcon:true,bool_enableExpandCollapseIcon:true,str_initialExpandCollapse:EXPANDED_STATE};if(cfg.str_sectionDomClassName.length===0){cfg.str_sectionDomClassName=cfg_defaults.str_sectionDomClassName;}if(cfg.str_sectionTitleText.length===0){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": Nothing meaningful provided by cfg.str_sectionTitleText, so heading item will not be generated. Setting relevant defaults.",true);cfg.bool_enableRefreshIcon=false;cfg.bool_enableExpandCollapseIcon=false;}if((cfg.str_initialExpandCollapse!==COLLAPSED_STATE)&&(cfg.str_initialExpandCollapse!==EXPANDED_STATE)){cfg.str_initialExpandCollapse=cfg_defaults.str_initialExpandCollapse;}if(cfg.str_baseColor.length!==7){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": Invalid cfg.str_baseColor value ('"+cfg.str_baseColor+"'). Expected standard hex-color string value. Defaulting to '"+cfg_defaults.str_baseColor+"'.",true);cfg.str_baseColor=cfg_defaults.str_baseColor;}cfg.str_headerColor=colorShade(cfg.str_baseColor,-0.1);cfg.str_subHeaderColor=colorShade(cfg.str_baseColor,-0.05);function expandSection(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": expandSection(): Starting...",true);window.expandContainer(cfg.str_containerNodeID);return;}function collapseSection(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": collapseSection(): Starting...",true);window.collapseContainer(cfg.str_containerNodeID);return;}function expandSubSection(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": expandSubSection(): Starting...",true);return;}function collapseSubSection(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": collapseSubSection(): Starting...",true);return;}function handleRefreshIconClick(evt){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": handleRefreshIconClick(): Starting...",true);try{evt.preventDefault();evt.stopPropagation();evt.stopImmediatePropagation();if(cfg.objFxn_refreshHandler()){expandSection();}else{return FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": handleRefreshIconClick(): Refresh handler did not return an explicit 'true' result.",true);}}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": handleRefreshIconClick(): Caught error ("+err.message+").",true);}}function handleExpCollIconClick(evt){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": handleExpCollIconClick(): Starting...",true);try{var objNodeRef_iconClicked=evt.currentTarget;var objNodeRef_listItem=objNodeRef_iconClicked.parentNode;var str_listItemClass=objNodeRef_listItem.getAttribute("class");evt.preventDefault();evt.stopPropagation();evt.stopImmediatePropagation();if(str_listItemClass.indexOf("subsectionheader")>-1){return toggleExpandCollapse_subsection(evt);}else{if(str_listItemClass.indexOf("sectionheader")>-1){return toggleExpandCollapse_contentWrapper(evt);}else{return FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": handleExpCollIconClick(): List-item class not understood ('"+str_listItemClass+"').",true);}}}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": handleExpCollIconClick(): Caught error ("+err.message+").",true);}}function handleSubheaderClick(evt){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": handleSubheaderClick(): Starting...",true);try{if(FavScreen.get("attrInteractionMode")!==window.MODE_EDITABLE){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleSubheaderClick(): Current mode is '"+FavScreen.get("attrInteractionMode")+"', no action necessary.",true);evt.preventDefault();evt.stopPropagation();evt.stopImmediatePropagation();return false;}var listItemClicked=evt.currentTarget;var favRecno=listItemClicked.getAttribute("id");var objSubheaderData=parseSingleRecordDataObjectForFavRecno(favRecno);cfg.objRef_subheaderEditPanelInstance.updatePanelWithNewSubsectionData(objSubheaderData);cfg.objRef_subheaderEditPanelInstance.show();}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": handleSubheaderClick(): Caught error ("+err.message+").",true);}}function listItemClickIsValid(evt){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): Starting...",true);try{var ret=true;var cfg_int_focusDelay=150;var cfg_int_jumpNavDelay=350;var cfg_int_additionalFooterClickOffset=10;var tsNow=Date.now();var tsLast_focus=FavScreen.get("attrLastFocused_window");var tsLast_jumpNav=FavScreen.get("attrJumpNavLastPressedTimestamp");var whereUserClickedY=evt.clientY;var nodeRefPagetitle=document.getElementById("pagetitle");var bottomOfPagetitle=nodeRefPagetitle.offsetTop+nodeRefPagetitle.offsetHeight;var topOfFooter=document.getElementById("footerwrapper").offsetTop;var currInteractionMode=FavScreen.get("attrInteractionMode");var currResponseRule=FavScreen.get("attrCurrentResponseRule");if(!isLoadedInMobileApp()&&(tsNow-tsLast_focus<=cfg_int_focusDelay)){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): Window was not in focus (tsNow-tsLast_focus="+(tsNow-tsLast_focus)+"ms, delay="+cfg_int_focusDelay+"ms). NOT taking action on message, since the click was likely done just to bring the window into focus.",true);ret=false;}if(tsNow-tsLast_jumpNav<=cfg_int_jumpNavDelay){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): User just pressed a jump-nav button (tsNow-tsLast_jumpNav="+(tsNow-tsLast_jumpNav)+"ms, delay="+cfg_int_jumpNavDelay+"ms). NOT taking action on message, since the click was likely done errantly while trying to press a jump-nav button.",true);ret=false;}if(whereUserClickedY<=bottomOfPagetitle){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): User just clicked in the pagetitle's area (whereUserClickedY:"+whereUserClickedY+" <= bottomOfPagetitle:"+bottomOfPagetitle+". NOT taking action on message, since the launch was likely unintended while trying to jump to top of document.",true);ret=false;}if(whereUserClickedY>(topOfFooter-cfg_int_additionalFooterClickOffset)){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): User just clicked in the footer's extra-padding area (whereUserClickedY:"+whereUserClickedY+" >= topOfFooter:"+topOfFooter+" - cfg_int_additionalFooterClickOffset:"+cfg_int_additionalFooterClickOffset+"). NOT taking action on message, since the click was likely done errantly while trying to press a jump-nav button.",true);ret=false;}if((currInteractionMode===MODE_REPLYING)&&(currResponseRule===ENCODED_RESPONSE_RULE_2)){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): User just clicked a message in reply mode with response-rule-2 in effect ('"+currResponseRule+"'), so cannot allow them to continue. Ending reply-mode (it should have already been ended).",true);window.handleAutoEndResponseMode_setOrReset(0);ret=false;}return ret;}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": listItemClickIsValid(): Caught error ("+err.message+").",true);}}function handleListItemClick(evt){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Starting, first checking to see if click is valid...",true);if(listItemClickIsValid(evt)===false){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Aborting invalid or disallowed click event.",true);return false;}try{var li=evt.currentTarget;var liID=li.getAttribute("id");var liClass=li.getAttribute("class");var ul=li.parentNode;var ulID=ul.getAttribute("id");evt.preventDefault();evt.stopPropagation();evt.stopImmediatePropagation();if(isNaN(liID)){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Click target ID attribute value is NaN ('"+liID+"'), aborting.",true);return false;}var cm=FavScreen.get("attrInteractionMode");FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Current mode is '"+cm+"'.",true);switch(cm){case window.MODE_LAUNCHABLE:if(ulID.indexOf("dropbox")>-1){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Dropbox items must be moved before launching ('"+liID+"'). Aborting launch.",true);window.ModalNotification_DropboxLaunch.showFor(2000);return false;}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Launching '"+liID+"'...",true);window.launchFavorite(liID);break;case window.MODE_REPLYING:FavScreen.objMsgData_replyWith={replyWithFavRecno:liID,replyWithFavIcon:window.getDataFromMessagecellDOM_favIconSrc(liID),replyWithFavName:window.getDataFromMessagecellDOM_favName(liID),replyWithMsgTemplateDir:window.rsRec_getMsgTemplateDir(FavScreen.rsOrig,liID)};if(liClass.indexOf("libmsg")>-1){FavScreen.objMsgData_replyWith.replyWithMsgTemplateName=window.getDataFromMessagecellDOM_msgTemplateName(liID);FavScreen.objMsgData_replyWith.replyWithMsgTemplateRecno=window.getDataFromMessagecellDOM_msgTemplateRecno(liID);if(window.getDataFromMessagecellDOM_libPin(liID).trim()==window.FAVS_LIB_USER_STDREPLIES_PIN){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Reply-with message is in the standard-reply library. Showing reply-dialog...",false);return FavScreen.MessageReplyDialog.show();}else{FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Reply-with message is not in the standard-reply library. Treating it like a normal reply, and launching...",false);window.launchFavorite(liID);}}else{FavScreen.objMsgData_replyWith.replyWithMsgTemplateName=window.rsRec_getMsgTemplateName(FavScreen.rsOrig,liID);FavScreen.objMsgData_replyWith.replyWithMsgTemplateRecno=window.rsRec_getMsgTemplateRecno(FavScreen.rsOrig,liID);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Reply-with message does not belong to a library (it may be a normal message). Launching...",false);window.launchFavorite(liID);}break;case window.MODE_EDITABLE:if(liClass===null||liClass.indexOf("messagecell")===-1){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Invalid item for editing ('"+liID+"'). Aborting edit.",true);return false;}else{if(liClass.indexOf("libmsg")>-1){var li_nest=ul.parentNode;if((typeof li_nest!=="undefined")&&(li_nest.getAttribute("data-userpin")!==null)){if(li_nest.getAttribute("data-userpin")!=window.CURRENT_USER_PIN){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Current user not allowed to edit shared-library item ('"+liID+"') owned by '"+li_nest.getAttribute("data-userpin").trimRight()+"'. Aborting edit.",true);return false;}}}}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Editing '"+liID+"'...",true);window.editFav_popPanel(liID,evt,li);break;case window.MODE_DELETED:default:break;}return true;}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": handleListItemClick(): Caught error ("+err.message+").",true);}}function generateMoveHandleIcon(){var oNode_img_move=document.createElement("img");oNode_img_move.setAttribute("class","headericon");oNode_img_move.style.visibility="hidden";return oNode_img_move;}function generateExpandCollapseIcon(){var str_initialExpandCollapseIconSrc=String();if(cfg.str_initialExpandCollapse===COLLAPSED_STATE){str_initialExpandCollapseIconSrc=FAVS_ICON_MAXIMIZE;}else{str_initialExpandCollapseIconSrc=FAVS_ICON_MINIMIZE;}var oNode_img_expcoll=document.createElement("img");oNode_img_expcoll.setAttribute("class","headericon minmax");oNode_img_expcoll.src=str_initialExpandCollapseIconSrc;oNode_img_expcoll.onclick=handleExpCollIconClick;return oNode_img_expcoll;}function generateRefreshIcon(){var oNode_img_refresh=document.createElement("img");oNode_img_refresh.setAttribute("class","headericon");oNode_img_refresh.src=FAVS_ICON_REFRESH;oNode_img_refresh.onclick=handleRefreshIconClick;return oNode_img_refresh;}function generateFloatClearingElement(){var oNode_div_clearfloats=document.createElement("div");oNode_div_clearfloats.setAttribute("class","clearfloats");return oNode_div_clearfloats;}function generateListItem_header(){var ret=false;var needFloatClear=Boolean(false);var cfg_li_domID="";var cfg_li_classname="sectionheader sublistheader roundedtopcorners8";var cfg_li_style="background-color:"+cfg.str_headerColor+";";FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_header(): Starting...",true);try{var oNode_li=document.createElement("li");oNode_li.setAttribute("id",cfg_li_domID);oNode_li.setAttribute("class",cfg_li_classname);oNode_li.setAttribute("style",cfg_li_style);var oNode_text_sectionTitleText=document.createTextNode(cfg.str_sectionTitleText);var oNode_span_sectionTitleText=document.createElement("span");oNode_span_sectionTitleText.appendChild(oNode_text_sectionTitleText);oNode_li.appendChild(oNode_span_sectionTitleText);if(cfg.bool_enableRefreshIcon){oNode_li.appendChild(generateRefreshIcon());needFloatClear=true;}if(cfg.bool_enableExpandCollapseIcon){oNode_li.appendChild(generateExpandCollapseIcon());needFloatClear=true;}if(needFloatClear){oNode_li.appendChild(generateFloatClearingElement());}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_header(): Completed. Returning LI node.",true);return oNode_li;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_header(): Caught error ("+err.message+"). Header list-item cell not generated.",true);return ret;}}function generateListItem_subHeader(obj_data){var ret=false;var needFloatClear=Boolean(false);var cfg_li_classname="subsectionheader sublistheader roundedtopcorners8 sortable ";var cfg_li_style="background-color:"+cfg.str_subHeaderColor+";";FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_subHeader(): Starting...",true);try{if(typeof obj_data!=="object"){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_subHeader(): Valid obj_data argument is required (obj_data type is "+typeof obj_data+"). Aborting and returning "+ret+".",true);return ret;}if(obj_data.color.indexOf("#")===0){var color_darkened=colorShade(obj_data.color,-0.1);var arr_RGB=color_HexToRGB(color_darkened);var arr_HSV=color_RGBtoHSV(arr_RGB);var sat=arr_HSV[1];sat=sat*1.3;sat=sat>255?255:sat;arr_HSV[1]=sat;arr_RGB=color_HSVtoRGB(arr_HSV);cfg_li_style="background-color:"+color_RGBtoHex(arr_RGB)+";";}var oNode_li=document.createElement("li");oNode_li.setAttribute("id",obj_data.recno_fav);oNode_li.setAttribute("class",cfg_li_classname);oNode_li.setAttribute("style",cfg_li_style);oNode_li.onclick=handleSubheaderClick;var oNode_a_forJumpNav=document.createElement("a");oNode_a_forJumpNav.setAttribute("id","personallibAnchor_"+obj_data.recno_fav);oNode_a_forJumpNav.setAttribute("name","personallibAnchor_"+obj_data.recno_fav);oNode_a_forJumpNav.setAttribute("class","subsectionAnchor jumpEligible");var oNode_text_sectionTitleText=document.createTextNode(obj_data.label1);var oNode_span_sectionTitleText=document.createElement("span");oNode_span_sectionTitleText.appendChild(oNode_text_sectionTitleText);oNode_li.appendChild(oNode_a_forJumpNav);oNode_li.appendChild(oNode_span_sectionTitleText);oNode_li.appendChild(generateMoveHandleIcon());if(cfg.bool_enableExpandCollapseIcon){oNode_li.appendChild(generateExpandCollapseIcon());needFloatClear=true;}if(needFloatClear){oNode_li.appendChild(generateFloatClearingElement());}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_subHeader(): Completed. Returning LI node.",true);return oNode_li;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_subHeader(): Caught error ("+err.message+"). Sub-header list-item cell not generated.",true);return ret;}}function generateListItem_messageCell(obj_data){var ret=false;var needFloatClear=Boolean(false);var cfg_li_classname="messagecell sortable ";FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_messageCell(): Starting...",true);try{if(typeof obj_data!=="object"){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_messageCell(): Valid obj_data argument is required (obj_data type is "+typeof obj_data+"). Aborting and returning "+ret+".",true);return ret;}var oNode_li=document.createElement("li");oNode_li.setAttribute("id",obj_data.recno_fav);oNode_li.setAttribute("class",cfg_li_classname);oNode_li.style.backgroundColor=obj_data.color;oNode_li.style.marginLeft="-2px";oNode_li.style.marginRight="-2px";oNode_li.setAttribute("data-msgtemplatename",obj_data.msgname);oNode_li.setAttribute("data-msgtemplaterecno",obj_data.recno_msgtemplate);oNode_li.onclick=handleListItemClick;var oNode_img_icon=document.createElement("img");if(obj_data.icon.length>0){oNode_img_icon.src=FAVS_ICON_PATH+"/"+obj_data.icon;}else{oNode_img_icon.src=FAVS_ICON_PATH+"/"+FAVS_DEFAULT_UNSORTED_ICON_FILE;}var oNode_div_iconwrapper=document.createElement("div");oNode_div_iconwrapper.setAttribute("class","iconwrapper");oNode_div_iconwrapper.appendChild(oNode_img_icon);var oNode_text_line1;if(obj_data.label1.length>0){oNode_text_line1=document.createTextNode(obj_data.label1);}else{oNode_text_line1=document.createTextNode(obj_data.msgname);}var oNode_div_namewrapper=document.createElement("div");oNode_div_namewrapper.setAttribute("class","namewrapper");oNode_div_namewrapper.appendChild(oNode_text_line1);var oNode_text_line2;var oNode_div_descwrapper=document.createElement("div");oNode_div_descwrapper.setAttribute("class","descriptionwrapper");if(obj_data.label2.length>0){oNode_text_line2=document.createTextNode(obj_data.label2);oNode_div_descwrapper.appendChild(oNode_text_line2);}else{oNode_div_namewrapper.style.marginTop="7px";oNode_div_namewrapper.style.fontSize="15px";}var oNode_div_textwrapper=document.createElement("div");oNode_div_textwrapper.setAttribute("class","textwrapper");oNode_div_textwrapper.appendChild(oNode_div_namewrapper);oNode_div_textwrapper.appendChild(oNode_div_descwrapper);var oNode_img_draghandle=document.createElement("img");oNode_img_draghandle.setAttribute("id","draghandleicon_"+obj_data.recno_fav);oNode_img_draghandle.setAttribute("class","affectedbyinteractionmode ");oNode_img_draghandle.src=FAVS_ICON_PATH+"/"+FAVS_ICON_DRAGHANDLE;oNode_img_draghandle.display="none";var oNode_img_toggle=document.createElement("img");oNode_img_toggle.setAttribute("id","toggleicon_"+obj_data.recno_fav);oNode_img_toggle.setAttribute("class","affectedbytoggle ");oNode_img_toggle.src=FAVS_ICON_TOGGLE_CLOSE;oNode_img_toggle.display="none";var oNode_div_actionwrapper=document.createElement("div");oNode_div_actionwrapper.setAttribute("class","actionwrapper");oNode_div_actionwrapper.appendChild(oNode_img_draghandle);oNode_div_actionwrapper.appendChild(oNode_img_toggle);oNode_div_actionwrapper.style.display="none";oNode_li.appendChild(oNode_div_actionwrapper);oNode_li.appendChild(oNode_div_iconwrapper);oNode_li.appendChild(oNode_div_textwrapper);var oNode_div_clearfloats=document.createElement("div");oNode_div_clearfloats.setAttribute("class","clearfloats");oNode_li.appendChild(oNode_div_clearfloats);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_messageCell(): Completed. Returning LI node.",true);return oNode_li;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_messageCell(): Caught error ("+err.message+"). A messagecell list-item was not generated.",true);return ret;}}function generateListItem_noMessagesCell(obj_data){var ret=false;var cfg_li_domID="";var cfg_li_classname="nomessages sortable";var cfg_li_style="";FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_noMessagesCell(): Starting...",true);try{if(typeof obj_data==="undefined"){obj_data={color:""};}var oNode_li=document.createElement("li");oNode_li.setAttribute("id",cfg_li_domID);oNode_li.setAttribute("class",cfg_li_classname);oNode_li.setAttribute("style",cfg_li_style);oNode_li.style.backgroundColor=obj_data.color;oNode_li.style.marginLeft="-2px";oNode_li.style.marginRight="-2px";var oNode_text_noMessages=document.createTextNode(FAVS_DEFAULT_NOFAVSTODISPLAYHTML);var oNode_span_noMessages=document.createElement("span");oNode_span_noMessages.appendChild(oNode_text_noMessages);oNode_li.appendChild(oNode_span_noMessages);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_noMessagesCell(): Completed. Returning LI node.",true);return oNode_li;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListItem_noMessagesCell(): Caught error ("+err.message+"). A no-messages list-item was not generated.",true);return ret;}}function generateListNode(){var ret=false;var cfg_ul_classname="messagelist";var needFloatClear=Boolean(false);FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": generateListNode(): Starting...",true);try{var cfg_ul_domID=cfg.str_sectionDomID;cfg_ul_classname=cfg_ul_classname+" "+cfg.str_sectionDomClassName;var oNode_ul=document.createElement("ul");oNode_ul.setAttribute("id",cfg_ul_domID);oNode_ul.setAttribute("class",cfg_ul_classname);var oNode_li_sectionHeading=generateListItem_header();oNode_ul.appendChild(oNode_li_sectionHeading);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": generateListNode(): Completed. Returning UL node (note: to populate it with list-items, run populateListNode).",true);return oNode_ul;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": generateListNode(): Caught error ("+err.message+").",true);return ret;}}function determineAndPrepareDataSource(){var ret=[];FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): Starting...",true);try{var nameOfObject,sizeOfRecordset;if((typeof cfg.objArr_messageData==="object")&&(typeof cfg.objYuiRS_messageData==="object")){nameOfObject=String(cfg.objYuiRS_messageData.name);if(nameOfObject==="recordset"){sizeOfRecordset=cfg.objYuiRS_messageData.size();if(sizeOfRecordset>0){cfg.objYuiRS_messageData.each(function(){ret.push(this.get("data"));});}else{FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): No records in recordset. (sizeOfRecordset = "+sizeOfRecordset+").",true);}}else{FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): Recordset provided is not actually a YUI Recordset (nameOfObject = "+nameOfObject+"). No other data sources available, aborting.",true);return ret;}}else{if((typeof cfg.objArr_messageData==="object")&&(typeof cfg.objYuiRS_messageData!=="object")){var lengthOfObjectArray=cfg.objArr_messageData.length;if(lengthOfObjectArray>=0){ret=cfg.objArr_messageData;}else{FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): No array length available (lengthOfObjectArray = "+lengthOfObjectArray+"). No other data sources available, aborting.",true);return ret;}}else{if((typeof cfg.objArr_messageData!=="object")&&(typeof cfg.objYuiRS_messageData==="object")){nameOfObject=String(cfg.objYuiRS_messageData.name);if(nameOfObject==="recordset"){sizeOfRecordset=cfg.objYuiRS_messageData.size();if(sizeOfRecordset>0){cfg.objYuiRS_messageData.each(function(){ret.push(this.get("data"));});}else{FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): No records in recordset. (sizeOfRecordset = "+sizeOfRecordset+").",true);}}else{FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): Recordset provided is not actually a YUI Recordset (nameOfObject = "+nameOfObject+"). No other data sources available, aborting.",true);return ret;}}else{FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): No data sources available, aborting.",true);return ret;}}}if(cfg.objArr_messageData.length===0){cfg.objArr_messageData=ret;}return ret;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": determineAndPrepareDataSource(): Caught error ("+err.message+").",true);return ret;}}function parseSingleRecordDataObjectForFavRecno(str_favRecno){var ret=false;for(var i=0;i<cfg.objArr_messageData.length;i++){if(cfg.objArr_messageData[i].recno_fav==str_favRecno){return cfg.objArr_messageData[i];}}if(!ret){for(var i=0;i<cfg.objYuiRS_messageData.size();i++){if(cfg.objYuiRS_messageData.item(i).get("data").recno_fav==str_favRecno){return cfg.objYuiRS_messageData.item(i).get("data");}}}return ret;}function parsePositionTypeFlag(str_position){var ret=String();function getTypeChar(str){return String(str).split(FAVS_POSITION_DELINEATE_TYPE)[0];}try{ret=window.FAVS_UNSORTED_FLAG;if(typeof str_position!=="string"){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionTypeFlag('"+String(str_position)+"'): Argument is not a string, attempting to convert and return...",true);ret=getTypeChar(str_position);}else{ret=getTypeChar(str_position);FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionTypeFlag('"+String(str_position)+"'): Completed. Returning '"+ret+"'.",true);}return ret;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionTypeFlag('"+String(str_position)+"'): Caught error ("+err.message+").",true);return ret;}}function parsePositionValueForDimension(str_position,int_dimension){var ret=-1;try{ret=window.FAVS_UNSORTED_FLAG;if(typeof str_position!=="string"){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionValueForDimension('"+String(str_position)+"', "+int_dimension+"): Argument is not a string, attempting to convert and continue...",true);str_position=String(str_position);}if(typeof int_dimension!=="number"){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionValueForDimension('"+String(str_position)+"', "+int_dimension+"): Argument is not a number-type, attempting to convert and continue...",true);int_dimension=parseInt(int_dimension,10);}ret=str_position.split(FAVS_POSITION_DELINEATE_TYPE)[1].split(FAVS_POSITION_DELINEATE_COORD)[int_dimension-1];FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionValueForDimension('"+String(str_position)+"', "+int_dimension+"): Completed. Returning '"+ret+"'.",true);return ret;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": parsePositionValueForDimension('"+String(str_position)+"'): Caught error ("+err.message+").",true);return ret;}}function populateListNode(){var ret=0;var objArr_data=determineAndPrepareDataSource();FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Starting...",true);try{var objNodeRef_theList=document.getElementById(cfg.str_sectionDomID);if(typeof objNodeRef_theList==="undefined"){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): No list-node available (objNodeRef_theList = "+objNodeRef_theList+"). Run generateListNode(), first. Aborting.",true);return ret;}var objNode_listItem;var str_positionTypeFlag;var str_color;var int_sortOrder_dimA=int_sortOrder_dimB=-1;if(objArr_data.length>0){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): "+objArr_data.length+" msg/subsection item(s) exist in the data source.",true);var obj_listItem;for(var i=0;i<objArr_data.length;i++){obj_listItem=objArr_data[i];int_sortOrder_dimA=parseInt(parsePositionValueForDimension(obj_listItem.position,1),10);int_sortOrder_dimB=parseInt(parsePositionValueForDimension(obj_listItem.position,2),10);str_positionTypeFlag=parsePositionTypeFlag(obj_listItem.position);switch(str_positionTypeFlag){case window.FAVS_LIBRARY_PERSONAL_FLAG:FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Item is a 'personal library' type, and may either be a normal message or a subsection header.",true);if(int_sortOrder_dimA>0&&int_sortOrder_dimB===0){if(i>0){var obj_listItem_prev=objArr_data[i-1];var int_sortOrder_dimA_prev=parseInt(parsePositionValueForDimension(obj_listItem_prev.position,1),10);var int_sortOrder_dimB_prev=parseInt(parsePositionValueForDimension(obj_listItem_prev.position,2),10);if(int_sortOrder_dimA_prev>0&&int_sortOrder_dimB_prev===0){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): No msg-items existed in the previous subsection, displaying 'no messages' there.",true);obj_listItem_prev.color=str_color;objNode_listItem=generateListItem_noMessagesCell(obj_listItem_prev);objNodeRef_theList.appendChild(objNode_listItem);ret++;}}FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Personal-library record is a sub-section header record.",true);objNode_listItem=generateListItem_subHeader(obj_listItem);str_color=obj_listItem.color;}else{if(int_sortOrder_dimA>0&&int_sortOrder_dimB>0){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Personal-library record is a sub-section's message record.",true);obj_listItem.color=str_color;objNode_listItem=generateListItem_messageCell(obj_listItem);}else{if(int_sortOrder_dimA===0&&int_sortOrder_dimB>0){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Personal-library record is an orphaned message record (no subheader exists).",true);objNode_listItem=generateListItem_messageCell(obj_listItem);}else{if(int_sortOrder_dimA===0&&int_sortOrder_dimB===0){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Personal-library record has strange position value (both dimensions are 0). This could be an early-development artifact? Generating messagecell.",true);objNode_listItem=generateListItem_messageCell(obj_listItem);}else{FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Personal-library record contains unexpected position value, generating messagecell.",true);objNode_listItem=generateListItem_messageCell(obj_listItem);}}}}break;case window.FAVS_SORTED_FLAG:case window.FAVS_UNSORTED_FLAG:default:FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Item is a type that doesn't use sub-section capability.",true);FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Requesting LI node for msg-item "+i+"...",true);objNode_listItem=generateListItem_messageCell(obj_listItem);break;}objNodeRef_theList.appendChild(objNode_listItem);ret++;}}else{FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): No msg-items exist in the data source, displaying 'no messages'.",true);objNode_listItem=generateListItem_noMessagesCell();objNodeRef_theList.appendChild(objNode_listItem);}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Completed. Returning number of list-items added ("+ret+").",true);return ret;}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": populateListNode(): Caught error ("+err.message+"). No list-items added.",true);return ret;}}function padLeadingZeros(intValueToPad,intMaxTotalDigits){var s=intValueToPad+"";while(s.length<intMaxTotalDigits){s="0"+s;}return s;}function getNumberOfSubsectionHeaders(){var ret=0;var objNodeRef_theList=document.getElementById(cfg.str_sectionDomID);var arr_listItemNodes=objNodeRef_theList.childNodes;for(var i=0;i<arr_listItemNodes.length;i++){if(arr_listItemNodes[i].getAttribute("class").indexOf("subsectionheader")>-1){ret++;}}return ret;}this.bool_isInstanceInitialized=false;this.bool_isRendered=false;this.bool_isVisible=false;this.cfg=cfg;this.generateListItem_noMessagesCell=generateListItem_noMessagesCell;this.makeListSectionVisible=function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionVisible(): Starting...",true);var ret=false;function doStuffToSupportBetaPrototype(){FavScreen.set("attrIsCurrentlyVisible_sorted",true);}try{var objNodeRef_sectionContainer=document.getElementById(cfg.str_containerNodeID);objNodeRef_sectionContainer.style.visibility="visible";ret=objNodeRef_sectionContainer.style.visibility;if(ret==="visible"){this.bool_isVisible=true;doStuffToSupportBetaPrototype();}else{this.bool_isVisible=false;}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionVisible(): Set bool_isVisible to "+this.bool_isVisible+".",true);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionVisible(): Completed. Returning '"+ret+"'.",true);}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionVisible(): Caught error ("+err.message+"). Returning "+this.bool_isVisible+".",true);}return ret;};this.makeListSectionHidden=function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionHidden(): Starting...",true);var ret=false;try{var objNodeRef_sectionContainer=document.getElementById(cfg.str_containerNodeID);objNodeRef_sectionContainer.style.visibility="hidden";ret=objNodeRef_sectionContainer.style.visibility;if(ret==="hidden"){this.bool_isVisible=false;}else{this.bool_isVisible=true;}FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionHidden(): Set bool_isVisible to "+this.bool_isVisible+".",true);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionHidden(): Completed. Returning '"+ret+"'.",true);}catch(err){FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": makeListSectionHidden(): Caught error ("+err.message+"). Returning "+this.bool_isVisible+".",true);}return ret;};this.renderListInItsSection=function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": renderListInItsSection(): Starting...",true);function doStuffToSupportBetaPrototype(t){try{window.updateMessagecells();t.attachActionListenersToMessageCells();}catch(err){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": renderListInItsSection(): doStuffToSupportBetaPrototype(): Caught error ("+err.message+").",true);}}try{var objNodeRef_sectionContainer=document.getElementById(cfg.str_containerNodeID);objNodeRef_sectionContainer.style.backgroundColor=cfg.str_baseColor;var objNode_completedSection=generateListNode();for(var i=0;i<objNodeRef_sectionContainer.childNodes.length;i++){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": renderListInItsSection(): Removing an existing child (#"+objNodeRef_sectionContainer.childNodes[i].id+") found in the container, before appending new list.",true);objNodeRef_sectionContainer.removeChild(objNodeRef_sectionContainer.childNodes[i]);}objNodeRef_sectionContainer.appendChild(objNode_completedSection);this.bool_isRendered=true;this.makeListSectionVisible();this.numOfItemsPopulated=populateListNode();doStuffToSupportBetaPrototype(this);FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": renderListInItsSection(): Completed. Returning entire major-section node.",true);return objNodeRef_sectionContainer;}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": renderListInItsSection(): Caught error ("+err.message+").",true);}};this.exportListAsYuiRecordset=function(bool_extractAllFields){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): Starting...",true);var ret={};function initializeBlankRecordItem(bool_useAllFields){var blankRecord={};blankRecord.recno_fav="0";blankRecord.position="";if(Boolean(bool_extractAllFields)){blankRecord.active_copies="";blankRecord.color="";blankRecord.confirmSend=0;blankRecord.dtsec="";blankRecord.icon="";blankRecord.icon2="";blankRecord.label1="";blankRecord.label2="";blankRecord.msgdesc="";blankRecord.msgdir="";blankRecord.msgdir_recno="";blankRecord.msgname="";blankRecord.recno_msgtemplate="";blankRecord.toggle_duration="";blankRecord.toggle_end_dtsec="";}return blankRecord;}function recordsetIsInvalid(obj_yuiRS){if(typeof obj_yuiRS!=="object"){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): recordsetIsInvalid(): Argument is not an object, let alone a recordset!",true);return true;}if(obj_yuiRS.name!="recordset"){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): recordsetIsInvalid(): Argument is not a YUI-Recordset.",true);return true;}var ret=false;var rsSize,prevRecord,currRecord;try{rsSize=obj_yuiRS.size();}catch(err){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): recordsetIsInvalid(): Recordset object had problem with size() method ("+err.message+").",true);rsSize=0;}for(var i=0;i<rsSize;i++){currRecord=obj_yuiRS.item(i).get("data");if(i===0){prevRecord=initializeBlankRecordItem();}else{prevRecord=obj_yuiRS.item(i-1).get("data");}if(currRecord.position==prevRecord.position){FavScreen.log("info","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): recordsetIsInvalid(): Current record's ("+i+") position ("+currRecord.position+") matches previous record's position ("+prevRecord.position+").",true);ret=true;}}return ret;}try{if(this.cfg.str_sectionDomID!="messagelist-personallibraries"){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): This version only supports exporting the personal-libraries section.",true);return ret;}bool_extractAllFields=Boolean(bool_extractAllFields);FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): Extract all fields = "+bool_extractAllFields+".",true);var objNodeRef_theList=document.getElementById(this.cfg.str_sectionDomID);var arr_listItemNodes=objNodeRef_theList.childNodes;YUI().use("recordset-base",function(Y){ret=new Y.Recordset();ret.after("init",function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): YUI-Recordset initialized.",true);ret.after("add",function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): YUI-Recordset added a new record, size is now "+this.size()+".",true);});});});if(this.bool_isRendered!==true){FavScreen.log("warn","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): No list is rendered, returning empty recordset.",true);return ret;}var i_subsection=0;var i_message=0;var currItem,currItemID,currItemClass,currItemPosA,currItemPosB,currItemPosC,currItemPos,currItemDataObject;var prevItem,prevItemID,prevItemClass,prevItemPosA,prevItemPosB,prevItemPosC,prevItemPos,prevItemDataObject;var nextItem,nextItemID,nextItemClass,nextItemPosA,nextItemPosB,nextItemPosC,nextItemPos,nextItemDataObject;var autoItemDataObject;var positionTypeFlag=window.FAVS_LIBRARY_PERSONAL_FLAG;var posDelinType=window.FAVS_POSITION_DELINEATE_TYPE;var posDelinDim=window.FAVS_POSITION_DELINEATE_COORD;currItemPosA=currItemPosB=currItemPosC=0;prevItemPosA=prevItemPosB=prevItemPosC=0;nextItemPosA=nextItemPosB=nextItemPosC=0;for(var i=0;i<arr_listItemNodes.length;i++){currItem=arr_listItemNodes[i];currItemID=currItem.getAttribute("id");currItemClass=currItem.getAttribute("class");if(currItemClass.indexOf("subsectionheader")<0&&currItemClass.indexOf("messagecell")<0){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): Iteration #"+i+" is not a list-item that should be exported, skipping.",true);continue;}FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): Iteration #"+i+" list-item will now be processed for export...",true);try{currItemDataObject=rs_getRawDataObjectFor_favRecno(FavScreen.rsOrig,currItemID);if(typeof currItemDataObject!=="object"){currItemDataObject=initializeBlankRecordItem();}}catch(err){currItemDataObject=initializeBlankRecordItem();}if(i===0){prevItem=null;prevItemID="";prevItemClass="";prevItemDataObject=initializeBlankRecordItem();prevItemDataObject.position=String(positionTypeFlag+posDelinType+padLeadingZeros(prevItemPosA,5)+posDelinDim+padLeadingZeros(prevItemPosB,5)+posDelinDim+padLeadingZeros(prevItemPosC,5));}else{prevItem=arr_listItemNodes[i-1];prevItemID=prevItem.getAttribute("id");prevItemClass=prevItem.getAttribute("class");try{prevItemDataObject=rs_getRawDataObjectFor_favRecno(FavScreen.rsOrig,prevItemID);if(typeof currItemDataObject!=="object"){currItemDataObject=initializeBlankRecordItem();}}catch(err){prevItemDataObject=initializeBlankRecordItem();}}if(i===arr_listItemNodes.length-1){nextItem=null;nextItemID="";nextItemClass="";nextItemDataObject=initializeBlankRecordItem();nextItemDataObject.position=String(positionTypeFlag+posDelinType+padLeadingZeros(nextItemPosA,5)+posDelinDim+padLeadingZeros(nextItemPosB,5)+posDelinDim+padLeadingZeros(nextItemPosC,5));}else{nextItem=arr_listItemNodes[i+1];nextItemID=nextItem.getAttribute("id");nextItemClass=nextItem.getAttribute("class");try{nextItemDataObject=rs_getRawDataObjectFor_favRecno(FavScreen.rsOrig,nextItemID);if(typeof currItemDataObject!=="object"){currItemDataObject=initializeBlankRecordItem();}}catch(err){nextItemDataObject=initializeBlankRecordItem();}}FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  i#"+i+" prev is '"+typeof prevItemDataObject+"' | curr is '"+typeof currItemDataObject+"' | next is '"+typeof currItemDataObject+"'.",true);if(currItemClass.indexOf("subsectionheader")>-1){if(prevItemClass.indexOf("subsectionheader")>-1||prevItemClass.indexOf("messagecell")>-1||prevItemClass.indexOf("sectionheader")>-1||prevItemClass.indexOf("nomessages")>-1){i_subsection++;i_message=0;currItemPosA=i_subsection;currItemPosB=i_message;currItemPosC=0;currItemPos=String(positionTypeFlag+posDelinType+padLeadingZeros(currItemPosA,5)+posDelinDim+padLeadingZeros(currItemPosB,5)+posDelinDim+padLeadingZeros(currItemPosC,5));currItemDataObject.position=currItemPos;FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  Adding existing subsection-header to export ("+currItemPos+")...",true);if(currItemID===null){FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  Existing subsection-header has no recno, will flag server to add a new record for this...",true);currItemDataObject.recno_fav=String(window.FAVS_RECNO_FLAG_CREATE_SUBHEADER_BLANKNEW);}ret.add(currItemDataObject);}else{FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  Unexpected error, unknown list-item class/type for previous iteration.",true);}}else{if(currItemClass.indexOf("messagecell")>-1){if(getNumberOfSubsectionHeaders()===0){i_subsection=1;i_message=0;currItemPosA=i_subsection;currItemPosB=i_message;currItemPosC=0;currItemPos=String(positionTypeFlag+posDelinType+padLeadingZeros(currItemPosA,5)+posDelinDim+padLeadingZeros(currItemPosB,5)+posDelinDim+padLeadingZeros(currItemPosC,5));autoItemDataObject=initializeBlankRecordItem(true);autoItemDataObject.recno_fav=String(window.FAVS_RECNO_FLAG_CREATE_SUBHEADER_PERSONALMSGS);autoItemDataObject.position=currItemPos;FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  Adding new/auto-generated subsection-header to export ("+currItemPos+")...",true);ret.add(autoItemDataObject);}i_message++;currItemPosA=i_subsection;currItemPosB=i_message;currItemPosC=0;currItemPos=String(positionTypeFlag+posDelinType+padLeadingZeros(currItemPosA,5)+posDelinDim+padLeadingZeros(currItemPosB,5)+posDelinDim+padLeadingZeros(currItemPosC,5));currItemDataObject.position=currItemPos;FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  Adding existing message to export ("+currItemPos+")...",true);ret.add(currItemDataObject);}else{FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset():  Unexpected error, unknown list-item class/type for current iteration.",true);}}}}catch(err){return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": exportListAsYuiRecordset(): Caught error ("+err.message+").",true);}if(recordsetIsInvalid(ret)){return{};}return ret;};this.attachActionListenersToMessageCells=function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": attachActionListenersToMessageCells(): Starting...",true);var str_listNodeID_yuiIzed="ul#"+cfg.str_sectionDomID;window.attachActionListenersToMessageCells(str_listNodeID_yuiIzed);};this.initialize=function(){FavScreen.log("verbose","ClassMajorSection #"+cfg.str_sectionDomID+": initialize(): Starting...",true);if(this.bool_isConstructorLoaded){this.bool_isInstanceInitialized=true;FavScreen.log("log","ClassMajorSection #"+cfg.str_sectionDomID+": initialize(): Completed. Section contained in '"+cfg.str_containerNodeID+"', is ready to be rendered (call renderListInItsSection).",true);return this.bool_isInstanceInitialized;}else{return FavScreen.log("error","ClassMajorSection #"+cfg.str_sectionDomID+": initialize(): Class prototype not yet loaded (bool_isLoaded = "+this.bool_isLoaded+").",true);}};this.bool_isConstructorLoaded=true;}